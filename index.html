<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cemiteryal Death Carneficine ‚Ä¢ Site Oficial</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
/* *****************************************************************
 * 1. VARI√ÅVEIS DE TEMA
 ***************************************************************** */
:root, [data-theme="dark"] {
    --theme-background: #1a1a1a;
    --theme-primary: #fff;
    --theme-highlight: #00ffd5; /* Ciano/Verde */
    --theme-secondary: #00bfff;
    --theme-glass-bg: rgba(255,255,255,0.08);
    --theme-glass-border: rgba(255,255,255,0.18);
    --theme-glass-shadow: rgba(0,255,180,0.18);
    --theme-whatsapp-color: #25d366;
    --theme-input-text: #000;
}
[data-theme="red"] {
    --theme-background: #000000;
    --theme-primary: #fff;
    --theme-highlight: #ff4d4d; /* Vermelho Vivo */
    --theme-secondary: #cc0000;
    --theme-glass-bg: rgba(255,77,77,0.08);
    --theme-glass-border: rgba(255,77,77,0.18);
    --theme-glass-shadow: rgba(255,77,77,0.35);
    --theme-whatsapp-color: #f00; 
    --theme-input-text: #000;
}
[data-theme="light"] {
    --theme-background: #ffffff;
    --theme-primary: #000;
    --theme-highlight: #3333ff; /* Azul Escuro */
    --theme-secondary: #6666ff;
    --theme-glass-bg: rgba(0,0,0,0.08);
    --theme-glass-border: rgba(0,0,0,0.18);
    --theme-glass-shadow: rgba(51,51,255,0.18);
    --theme-whatsapp-color: #3333ff;
    --theme-input-text: #000;
}

/* *****************************************************************
 * 2. ESTILOS GLOBAIS COM VARI√ÅVEIS
 ***************************************************************** */
* { box-sizing: border-box; font-family: 'Segoe UI', Arial, sans-serif; }

body {
  margin: 0;
  min-height: 100vh;
  background: var(--theme-background); 
  color: var(--theme-primary);
  overflow-x: hidden;
  cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="font-size: 20px;"><text y="20">üïØÔ∏è</text></svg>') 12 12, auto;
}

/* FUNDO ANIMADO */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background:
    radial-gradient(circle at 20% 20%, var(--theme-highlight), transparent 40%),
    radial-gradient(circle at 80% 60%, var(--theme-secondary), transparent 40%);
  animation: bgmove 12s infinite alternate;
  opacity: 0.6;
  z-index: -1;
}

@keyframes bgmove {
  from { transform: translateY(0); }
  to { transform: translateY(-40px); }
}

nav {
  position: fixed;
  top: 0;
  width: 100%;
  padding: 14px 22px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: rgba(0,0,0,0.45);
  backdrop-filter: blur(16px);
  border-bottom: 1px solid rgba(255,255,255,0.15);
  z-index: 999;
}

nav a {
  color: var(--theme-primary);
  margin-left: 18px;
  text-decoration: none;
  font-size: 0.95rem;
  transition: 0.3s;
}

nav a:hover { color: var(--theme-whatsapp-color); }

.container {
  max-width: 1100px;
  margin: 110px auto 60px;
  padding: 20px;
}

/* TITULO */
h1 {
  text-align: center;
  letter-spacing: 1px;
  text-shadow: 0 0 15px var(--theme-highlight); 
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(230px,1fr));
  gap: 22px;
  margin-top: 40px;
}

/* CARDS, SE√á√ïES, MODAL (EFEITO VIDRO E BRILHO) */
.card, .support, .secret, .modal-content, #error404Modal .modal-content {
  background: var(--theme-glass-bg);
  backdrop-filter: blur(16px);
  border-radius: 20px;
  padding: 22px; 
  border: 1px solid var(--theme-glass-border);
  box-shadow: 0 0 25px var(--theme-glass-shadow), inset 0 0 15px rgba(255,255,255,0.06); 
  transition: 0.35s;
}

.card {
  text-align: center;
}
/* CORRE√á√ÉO DO CSS DA FOTO (GARANTINDO O CORTE CIRCULAR SEM DISTOR√á√ÉO) */
.card img {
    width: 150px; 
    height: 150px; 
    max-width: none;
    border-radius: 50%; 
    object-fit: cover; 
    margin-bottom: 15px;
    border: 3px solid var(--theme-highlight);
    box-shadow: 0 0 10px var(--theme-highlight);
    display: block; 
    margin-left: auto;
    margin-right: auto;
    overflow: hidden; 
}
/* Linktree Button Style */
.btn-linktree {
  padding: 10px 20px;
  margin-top: 10px;
  background: var(--theme-highlight);
  color: var(--theme-background);
  font-weight: bold;
  text-decoration: none;
  border-radius: 8px;
  display: block;
  width: 90%;
  margin: 10px auto 0;
  transition: background-color 0.3s;
}
.btn-linktree:hover {
    background: var(--theme-secondary);
}


/* Campos de INPUT */
.modal-content input[type="text"], .modal-content input[type="password"] {
    padding: 10px;
    margin: 8px 0;
    width: 100%;
    border-radius: 8px;
    border: 1px solid var(--theme-highlight);
    background-color: var(--theme-primary);
    color: var(--theme-input-text);
    outline: none;
    transition: 0.3s;
}

.btn {
  display: inline-block;
  margin-top: 18px;
  padding: 13px 30px;
  border-radius: 30px;
  background: linear-gradient(45deg, var(--theme-highlight), var(--theme-secondary));
  color: var(--theme-background);
  font-weight: bold;
  text-decoration: none;
  cursor: pointer;
  border: none;
  box-shadow: 0 0 25px var(--theme-highlight);
  transition: 0.3s;
}
.btn-select {
  padding: 5px 10px;
  margin: 0;
  font-size: 0.8rem;
}

/* ESTILOS DE NOTIFICA√á√ÉO (TOAST) */
#toastNotification {
  visibility: hidden;
  min-width: 250px;
  background-color: #000;
  color: #fff;
  text-align: center;
  border-radius: 12px;
  padding: 16px;
  position: fixed;
  z-index: 1000;
  left: 50%;
  transform: translateX(-50%);
  bottom: 30px;
  font-size: 1rem;
  border: 1px solid var(--theme-highlight);
  box-shadow: 0 0 20px var(--theme-highlight);
  transition: opacity 0.3s, bottom 0.3s;
}

#toastNotification.show {
  visibility: visible;
  animation: fadein 0.5s, fadeout 0.5s 2.5s;
}

@keyframes fadein {
  from {bottom: 0; opacity: 0;} 
  to {bottom: 30px; opacity: 1;}
}

@keyframes fadeout {
  from {opacity: 1;} 
  to {opacity: 0;}
}

/* ESTILOS DE MODAL */
.modal {
  display: none; 
  position: fixed;
  z-index: 1001;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  overflow: auto;
  background-color: rgba(0,0,0,0.8);
  backdrop-filter: blur(5px);
  padding-top: 60px;
}

.modal-content {
  margin: 5% auto;
  width: 80%;
  max-width: 400px;
  text-align: center;
}

.close {
  color: #aaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}

.close:hover,
.close:focus {
  color: var(--theme-highlight);
  text-decoration: none;
  cursor: pointer;
}

/* ANIMA√á√ÉO DE EXPLOS√ÉO DE EMOJIS */
@keyframes explode {
    0% { transform: scale(1); opacity: 1; filter: drop-shadow(0 0 5px var(--theme-highlight)); }
    50% { transform: scale(1.5) translateY(-20px); opacity: 0.8; }
    100% { transform: scale(0.5) translateY(-50px); opacity: 0; }
}


/* SELE√á√ÉO DE TEMAS */
.theme-selector-container {
    display: flex;
    gap: 15px;
    justify-content: center;
    margin-top: 15px;
    margin-bottom: 25px;
}
.theme-option {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    cursor: pointer;
    border: 2px solid var(--theme-glass-border);
    transition: transform 0.2s, box-shadow 0.2s;
}
.theme-option.active {
    border: 4px solid var(--theme-highlight);
    transform: scale(1.1);
    box-shadow: 0 0 10px var(--theme-highlight);
}

#theme-dark { background-color: #1a1a1a; }
#theme-red { background-color: #ff4d4d; }
#theme-light { background-color: #ffffff; border: 2px solid #ccc; }
</style>
</head>

<body data-theme="dark">

<nav onclick="playClickSound()">
  <div>üïØÔ∏è <strong>Cemiteryal</strong></div>
  <div>
    <a href="#inicio">In√≠cio</a>
    <a href="#admins">ADMs</a>
    <a href="#customization">Personalizar</a>
    <a href="#secreto">√Årea Secreta</a>
  </div>
</nav>

<audio id="clickSound" src="./audio/click.mp3"></audio>


<div class="container" id="inicio">
<h1>Cemiteryal Death Carneficine</h1>

<section id="admins" class="cards">
  <div class="card">
    <img src="https://i.imgur.com/IsaacPlaceholder.png" alt="Foto de Isaac (ADM 1)">
    <h3>Isaac (ADM 1)</h3>
    <a href="#" class="btn-linktree" onclick="checkLink(event, '')">Linktree</a>
  </div>
  
  <div class="card">
    <img src="https://i.imgur.com/FernandaPlaceholder.png" alt="Foto de Fernanda (ADM 2)">
    <h3>Fernanda (ADM 2)</h3>
    <a href="#" class="btn-linktree" onclick="checkLink(event, '')">Linktree</a> 
  </div>
  
  <div class="card">
    <img src="https://i.imgur.com/RafaelPlaceholder.png" alt="Foto de Rafael (ADM 3)">
    <h3>Rafael (ADM 3)</h3>
    <a href="#" class="btn-linktree" onclick="checkLink(event, '')">Linktree</a>
  </div>
  
  <div class="card">
    <img src="https://i.imgur.com/MarianaPlaceholder.png" alt="Foto de Mariana (ADM 4)">
    <h3>Mariana (ADM 4)</h3>
    <a href="#" class="btn-linktree" onclick="checkLink(event, '')">Linktree</a>
  </div>
  
  <div class="card">
    <img src="https://i.imgur.com/GustavoPlaceholder.png" alt="Foto de Gustavo (ADM 5)">
    <h3>Gustavo (ADM 5)</h3>
    <a href="#" class="btn-linktree" onclick="checkLink(event, '')">Linktree</a>
  </div>
</section>

<div class="support">
  <p><strong>Suporte ou parceria</strong></p>
  
  <a class="btn" 
     href="#" 
     onclick="handleWhatsClick(event)"
     id="whatsButton">Entre em contato</a>
  <br>
  
  <a class="btn" href="#">üì¢ Canal do WhatsApp</a>
</div>

<section id="customization" class="secret">
  <h3>üé® Personaliza√ß√£o (Temas, Cursor & Cliques)</h3>

  <h4>Esquema de Cores</h4>
  <div class="theme-selector-container">
    <div id="theme-dark" class="theme-option" onclick="setTheme('dark'); playClickSound()"></div>
    <div id="theme-red" class="theme-option" onclick="setTheme('red'); playClickSound()"></div>
    <div id="theme-light" class="theme-option" onclick="setTheme('light'); playClickSound()"></div>
  </div>

  <h4>M√©tricas do Site</h4>
  <p>Acessos Totais: <strong id="totalAccesses">0</strong></p>
  <p style="font-size: 0.85rem; opacity: 0.6;">(Este contador √© atualizado a cada visita)</p>
  
  <hr style="margin: 30px 0; border-color: var(--theme-glass-border);">
  <h4>Cursor & Emojis</h4>
  <p style="font-size: 0.9rem; opacity: 0.7;">
    Selecione um emoji para usar no seu cursor e na anima√ß√£o de clique.
  </p>
  <div id="admList" style="text-align: left; margin: 20px auto; max-width: 500px;">
    </div>
  <p>Emoji Atual: <span id="currentEmojiDisplay" style="font-size: 1.5rem;">üïØÔ∏è</span></p>
</section>

<section id="secreto" class="secret">
  <h3>üîí √Årea Secreta</h3>
  <button class="btn" onclick="openLoginFlow()">Login de ADM</button>
</section>

<footer>
¬© 2026 ‚Ä¢ Cemiteryal Death Carneficine
</footer>
</div>

<div id="toastNotification"></div>

<div id="modalLogin" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modalLogin')">&times;</span>
    <h3>üîë Login Registrado</h3>
    <input type="text" id="loginUser" placeholder="Seu Username" required>
    <input type="password" id="loginPass" placeholder="Sua Senha" required>
    <button class="btn" onclick="signInUser()">Entrar</button>
    <p style="font-size: 0.8em; margin-top: 15px; cursor: pointer;" onclick="openSecretModal()">
        <small>Tentativa com Chave Mestra?</small>
    </p>
  </div>
</div>

<div id="modalSecret" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modalSecret')">&times;</span>
    <h3>üóùÔ∏è Chave Mestra</h3>
    <p>Use a chave mestra APENAS para o primeiro acesso ou se esquecer a senha.</p>
    <input type="password" id="secretKey" placeholder="Chave Mestra Secreta" required>
    <button class="btn" onclick="checkSecretKey()">Prosseguir</button>
  </div>
</div>

<div id="modalRegister" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('modalRegister')">&times;</span>
    <h3>üìù Cadastro de ADM</h3>
    <p style="color: #ff4d4d;">Crie seu login pessoal para futuros acessos.</p>
    <input type="text" id="regUser" placeholder="Escolha um Username (ser√° seu login)" required>
    <input type="password" id="regPass" placeholder="Escolha uma Senha (m√≠nimo 6 caracteres)" required>
    <button class="btn" onclick="registerUser()">Cadastrar e Entrar</button>
  </div>
</div>

<div id="error404Modal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('error404Modal')">&times;</span>
    <h3>‚ö†Ô∏è Erro 404</h3>
    <p>O Linktree para este ADM ainda n√£o foi configurado.</p>
    <button class="btn" onclick="closeModal('error404Modal')" style="margin-top: 5px;">Entendido</button>
  </div>
</div>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, getDoc, setDoc, increment } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAsHXQr5k3HviBVEFPz918g_zcjUZdFpJY",
    authDomain: "cemiteryal-site.firebaseapp.com",
    projectId: "cemiteryal-site",
    storageBucket: "cemiteryal-site.firebasestorage.app",
    messagingSenderId: "935123054222",
    appId: "1:935123054222:web:f720f6ae514631dd94a3df"
  };

  const app = initializeApp(firebaseConfig);
  window.db = getFirestore(app);
  window.auth = getAuth(app); 
  
  // Expondo fun√ß√µes do Firebase para uso no JS
  window.firestore_doc = doc;
  window.firestore_getDoc = getDoc;
  window.firestore_setDoc = setDoc;
  window.firestore_increment = increment;

  window.auth_signIn = signInWithEmailAndPassword;
  window.auth_createUser = createUserWithEmailAndPassword;
  window.auth_signOut = signOut;

</script>

<script>
// Vari√°veis Globais
let clicks = 0;
let currentTheme = localStorage.getItem('cemiteryal_theme') || "dark";
let currentEmoji = localStorage.getItem('cemiteryal_emoji') || "üïØÔ∏è"; 
let userName = localStorage.getItem('cemiteryal_username'); 
let isRegistered = localStorage.getItem('cemiteryal_registered') === 'true';

const clickSound = document.getElementById("clickSound");
let toastTimeout;

const admData = [
    { name: "Isaac (ADM 1)", emojis: ["üíÄ", "üî•", "üòà"] },
    { name: "Fernanda (ADM 2)", emojis: ["üî™", "üåπ", "‚õìÔ∏è"] },
    { name: "Rafael (ADM 3)", emojis: ["üåë", "‚ö°", "üï∏Ô∏è"] },
    { name: "Mariana (ADM 4)", emojis: ["ü©∏", "ü¶Ñ", "üíî"] },
    { name: "Gustavo (ADM 5)", emojis: ["üëΩ", "‚ú®", "üí°"] },
];

// ----------------------------------------------------
// L√ìGICA DE √ÅUDIO (Vers√£o Corrigida)
// ----------------------------------------------------

function playClickSound() {
    if (clickSound) {
        clickSound.volume = 1.0; 
        clickSound.currentTime = 0;
        
        const playPromise = clickSound.play();
        
        if (playPromise !== undefined) {
            playPromise.then(() => {
                // √Åudio iniciado com sucesso
            }).catch(error => {
                // Console warning, mas o som est√° sendo tentado.
                console.warn("√Åudio pode estar sendo bloqueado: ", error.message); 
            });
        }
    }
}

function initializeAudio() {
    if (clickSound) {
        clickSound.load(); 
        document.body.removeEventListener('mousedown', initializeAudio);
    }
}


// ----------------------------------------------------
// L√ìGICA DE AUTENTICA√á√ÉO (Vers√£o Corrigida)
// ----------------------------------------------------

function usernameToEmail(username) {
    // Garante que o formato √© compat√≠vel com o email do Firebase
    return `${username.toLowerCase().replace(/[^a-z0-9]/g, '')}@cemiteryal.chat`;
}

function openLoginFlow() {
    playClickSound(); 
    if (isRegistered) {
        openModal('modalLogin'); 
    } else {
        openModal('modalSecret');
    }
}

function openSecretModal() {
    playClickSound();
    closeModal('modalLogin');
    openModal('modalSecret');
}

function checkSecretKey() {
    const pass = document.getElementById("secretKey").value;
    closeModal('modalSecret'); 

    const MASTER_KEY = "IsaacCarneficine2026"; 

    if (pass === MASTER_KEY) {
        showToast("Chave Mestra correta! Prossiga para o cadastro.", 'success');
        openModal('modalRegister'); 
    } else {
        showToast("Chave Mestra incorreta. Tente novamente.", 'error');
    }
}

// CORRE√á√ÉO: Fun√ß√£o de registro revisada para estabilidade
async function registerUser() {
    const user = document.getElementById("regUser").value.trim();
    const pass = document.getElementById("regPass").value;

    if (!user || pass.length < 6) {
        showToast("Username e senha (m√≠n. 6 caracteres) s√£o obrigat√≥rios.", 'warning');
        return;
    }
    
    closeModal('modalRegister');
    const email = usernameToEmail(user);

    try {
        const userCredential = await window.auth_createUser(window.auth, email, pass);
        
        // Login autom√°tico (O Firebase j√° logou o usu√°rio ap√≥s a cria√ß√£o)
        userName = user;
        localStorage.setItem('cemiteryal_username', userName);
        localStorage.setItem('cemiteryal_registered', 'true');
        isRegistered = true;

        showToast(`Cadastro de ${userName} realizado! Redirecionando...`, 'success');
        
        // Atraso para garantir a sincroniza√ß√£o antes de abrir o chat
        await new Promise(resolve => setTimeout(resolve, 500)); 
        window.open('./chat.html', '_blank');

    } catch (error) {
        if (error.code === 'auth/email-already-in-use') {
            showToast("Username j√° em uso! Tente fazer login ou escolha outro nome.", 'error');
            openModal('modalLogin');
        } else {
            showToast(`Erro no cadastro: ${error.message}`, 'error');
        }
        console.error("Erro no registro:", error);
    }
}

// CORRE√á√ÉO: Fun√ß√£o de login revisada para estabilidade
async function signInUser() {
    const user = document.getElementById("loginUser").value.trim();
    const pass = document.getElementById("loginPass").value;

    if (!user || !pass) {
        showToast("Username e senha s√£o obrigat√≥rios.", 'warning');
        return;
    }
    
    closeModal('modalLogin');
    const email = usernameToEmail(user);

    try {
        await window.auth_signIn(window.auth, email, pass);
        
        userName = user;
        localStorage.setItem('cemiteryal_username', userName);
        
        showToast(`Bem-vindo, ${userName}! Redirecionando...`, 'success');
        
        // Atraso de 500ms para estabilizar a sess√£o antes de abrir a nova janela
        await new Promise(resolve => setTimeout(resolve, 1000)); 
        
        window.open('./chat.html', '_blank');

    } catch (error) {
        localStorage.removeItem('cemiteryal_username'); 
        showToast("Login falhou. Verifique Username e Senha. C√≥digo: " + error.code, 'error');
        console.error("Erro de login:", error);
    }
}


// ----------------------------------------------------
// L√ìGICA DE LINKTREE (FOR√áANDO ERRO 404 PARA VAZIOS)
// ----------------------------------------------------

function checkLink(e, linkUrl) {
    e.preventDefault(); 
    
    if (!linkUrl || linkUrl.trim() === '') {
        openModal('error404Modal');
    } else {
        window.open(linkUrl, '_blank');
    }
}

// ----------------------------------------------------
// UTILIT√ÅRIOS (Temas, M√©trica, Modais, Emojis)
// ----------------------------------------------------

function setTheme(themeName) {
    document.body.setAttribute('data-theme', themeName);
    localStorage.setItem('cemiteryal_theme', themeName);
    
    document.querySelectorAll('.theme-option').forEach(btn => {
        btn.classList.remove('active');
    });
    const targetButton = document.getElementById(`theme-${themeName}`);
    if (targetButton) {
        targetButton.classList.add('active');
    }

    let message = `Tema ${themeName.toUpperCase()} aplicado com sucesso.`;
    if (themeName === 'red') message = '‚ò†Ô∏è Tema Black & Red ativado!';
    showToast(message, 'success');
}

function showToast(message, type = 'info') {
    const toast = document.getElementById("toastNotification");
    clearTimeout(toastTimeout); 

    let icon = '';
    if (type === 'success') icon = '‚úÖ ';
    if (type === 'error') icon = '‚ùå ';
    if (type === 'warning') icon = '‚ö†Ô∏è ';
    if (type === 'whatsapp') icon = 'üì± ';

    toast.innerHTML = icon + message;
    toast.className = "show";

    toastTimeout = setTimeout(() => {
        toast.className = toast.className.replace("show", "");
    }, 3000);
}

function openModal(id) {
    document.getElementById(id).style.display = "block";
}

function closeModal(id) {
    document.getElementById(id).style.display = "none";
}

function handleWhatsClick(e) {
  e.preventDefault(); 
  
  showToast("Encaminhando para o WhatsApp. Aviso de Bot ativado.", 'whatsapp');
  
  setTimeout(() => {
    window.open("https://api.whatsapp.com/send?phone=5531999999999&text=Ol%C3%A1!%20Gostaria%20de%20falar%20sobre%20suporte%20ou%20parceria%20no%20Cemiteryal%20Death%20Carneficine.", '_blank');
  }, 300);
}


// ADI√á√ÉO DE SOM DE CLIQUE E ANIMA√á√ÉO DE EMOJI EM TODOS OS LUGARES
document.addEventListener("click", e => {
  const target = e.target;
  
  const isInteractive = target.closest('.btn, .btn-select, .btn-linktree, .close') || 
                        target.tagName === 'A' || 
                        target.classList.contains('theme-option') || 
                        target.classList.contains('emoji-option');
  
  if (isInteractive) {
      playClickSound();

      const span = document.createElement("span");
      span.innerText = currentEmoji;
      span.style.position = "fixed";
      span.style.left = e.clientX + "px";
      span.style.top = e.clientY + "px";
      span.style.pointerEvents = "none";
      span.style.fontSize = "24px"; 
      span.style.animation = "explode 0.6s ease forwards"; 
      span.style.zIndex = 1000;
      document.body.appendChild(span);
      setTimeout(()=>span.remove(),600);
  }
});

const COUNTER_DOC_REF = { db: null, collection: 'site_metrics', docId: 'access_count' };
async function handleAccessCounter() {
    if (!window.db) return;
    COUNTER_DOC_REF.db = window.db;

    try {
        const docRef = window.firestore_doc(COUNTER_DOC_REF.db, COUNTER_DOC_REF.collection, COUNTER_DOC_REF.docId);
        
        if (!sessionStorage.getItem('visited')) {
            await window.firestore_setDoc(docRef, { count: window.firestore_increment(1) }, { merge: true });
            sessionStorage.setItem('visited', 'true');
        }
        
        const docSnap = await window.firestore_getDoc(docRef);
        if (docSnap.exists()) {
            const count = docSnap.data().count;
            document.getElementById('totalAccesses').innerText = count.toLocaleString('pt-BR');
        } else {
            document.getElementById('totalAccesses').innerText = '0 (Iniciando Contador)';
        }

    } catch(error) {
        console.error("Erro no contador de acessos:", error);
        document.getElementById('totalAccesses').innerText = 'Erro ao carregar';
    }
}

function generateAdmSelectors() {
    const list = document.getElementById("admList");
    let html = '';
    admData.forEach(adm => {
        html += `
            <div class="adm-selector">
                <strong>${adm.name}</strong>: 
                <div>
        `;
        adm.emojis.forEach(emoji => {
            html += `<span class="emoji-option" onclick="selectEmoji('${emoji}'); playClickSound();">${emoji}</span>`;
        });
        html += `
                </div>
                <button class="btn-select btn" onclick="selectEmoji('${adm.emojis[0]}')">Selecionar ${adm.emojis[0]}</button>
            </div>
        `;
    });
    list.innerHTML = html;
}

function selectEmoji(newEmoji) {
    currentEmoji = newEmoji;
    localStorage.setItem('cemiteryal_emoji', newEmoji); 
    
    document.getElementById("currentEmojiDisplay").innerText = newEmoji;
    
    const cursorUrl = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="font-size: 20px;"><text y="20">${newEmoji}</text></svg>') 12 12, auto`;
    document.body.style.cursor = cursorUrl;
    
    showToast(`Emoji ${newEmoji} selecionado com sucesso!`, 'success');
}

function initializeEmoji() {
    setTheme(currentTheme); 
    const display = document.getElementById("currentEmojiDisplay");
    if (display) {
        display.innerText = currentEmoji;
    }
    const cursorUrl = `url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" style="font-size: 20px;"><text y="20">${currentEmoji}</text></svg>') 12 12, auto`;
    document.body.style.cursor = cursorUrl;
    
    // Inicia a escuta para carregar o √°udio na primeira intera√ß√£o
    document.body.addEventListener('mousedown', initializeAudio, { once: true });
}

// Inicializa√ß√£o
document.addEventListener('DOMContentLoaded', () => {
    generateAdmSelectors();
    initializeEmoji();
    handleAccessCounter(); 
});
</script>

</body>
</html>
